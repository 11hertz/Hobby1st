<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ClubList">

	<!-- 동호회 수 -->
	<select id="countClub" resultType="int">
		select count(*) cl_count from
		club_list
	</select>
	
	
	<!-- 동호회 -->

	<insert id="createClub">
		insert into club_list values(clublist_seq.nextval, #{cl_name},
		#{cl_desc},
		#{cl_boss_id}, #{cl_boss_name}, #{cl_maxMem}, #{cl_local},
		default,
		default, #{cl_category_id}, #{cl_dCategory_id}, default, #{cl_photo})

		<selectKey resultType="int" order="AFTER"
			keyProperty="cl_id">
			select clublist_seq.currval from dual
		</selectKey>
	</insert>

	<select id="nameCheck" resultType="int">
		select count(*) from club_list
		where cl_name = #{cl_name}
	</select>

	<select id="selectAll" resultType="map">
		select * from club_list
	</select>
	
	<select id="selectSplit" resultType="kh.hobby1st.dto.ClubListDTO">
		select * from (select club_list.*, row_number() over (order by cl_id asc) rn from club_list)
								where rn between 1 and 10
	</select>

	<select id="selectClub" resultType="kh.hobby1st.dto.ClubListDTO">
	select * from club_list where cl_id = ${value}
	</select>

	<select id="searchClub" resultType="kh.hobby1st.dto.ClubListDTO">
		select * from club_list where
		${column} like '%' || #{value} || '%'
	</select>
	
	<!-- 해당 동호회 가입 여부 확인 -->
	<select id="checkMember" resultType="int">
		select count(*) from club_list l join club_member m on (l.cl_id = m.cm_seq) where m.cm_mem_id = #{mem_id} and l.cl_id = #{cl_id}
	</select>
	
	<!-- 해당 동호회 클럽장인지 여부 -->
	<select id="checkClubBoss" resultType="int">
		select count(*) from club_list where cl_boss_id = #{mem_id} and cl_id = #{cl_id}
	</select>
	
	
	

</mapper>